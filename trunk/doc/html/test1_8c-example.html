<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Application Heartbeats: test1.c</title>
<img src="img/hb.png" height="100" border="0" alt="Hearbeats"></a>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>test1.c</h1>Program to demonstrate shared memory.<p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<span class="preprocessor">#include &lt;sys/ipc.h&gt;</span>
<span class="preprocessor">#include &lt;sys/shm.h&gt;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;unistd.h&gt;</span>

<span class="preprocessor">#define SHMSZ     27</span>
<span class="preprocessor"></span>
<span class="keywordtype">int</span> <a name="a0"></a><a class="code" href="application_8c.html#3c04138a5bfe5d72780bb7e82a18e627">main</a>()
{
    <span class="keywordtype">char</span> c;
    <span class="keywordtype">int</span> shmid;
    key_t key;
    <span class="keywordtype">char</span> *shm, *s;

    <span class="comment">/*</span>
<span class="comment">     * We'll name our shared memory segment</span>
<span class="comment">     * "5678".</span>
<span class="comment">     */</span>
    key = 5678;

    <span class="comment">/*</span>
<span class="comment">     * Create the segment.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> ((shmid = shmget(key, <a name="a1"></a><a class="code" href="test1_8c.html#f328b6ce3cae231d90cfbf2f340d03c2">SHMSZ</a>, IPC_CREAT | 0666)) &lt; 0) {
        perror(<span class="stringliteral">"shmget"</span>);
        exit(1);
    }

    <span class="comment">/*</span>
<span class="comment">     * Now we attach the segment to our data space.</span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> ((shm = shmat(shmid, NULL, 0)) == (<span class="keywordtype">char</span> *) -1) {
        perror(<span class="stringliteral">"shmat"</span>);
        exit(1);
    }

    <span class="comment">/*</span>
<span class="comment">     * Now put some things into the memory for the</span>
<span class="comment">     * other process to read.</span>
<span class="comment">     */</span>
    s = shm;

    <span class="keywordflow">for</span> (c = <span class="charliteral">'a'</span>; c &lt;= <span class="charliteral">'z'</span>; c++)
        *s++ = c;
    *s = <span class="charliteral">'\0'</span>;

    <span class="comment">/*</span>
<span class="comment">     * Finally, we wait until the other process </span>
<span class="comment">     * changes the first character of our memory</span>
<span class="comment">     * to '*', indicating that it has read what </span>
<span class="comment">     * we put there.</span>
<span class="comment">     */</span>
    <span class="keywordflow">while</span> (*shm != <span class="charliteral">'*'</span>)
        sleep(1);

    exit(0);
}
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jan 12 16:25:07 2010 for Application Heartbeats by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
